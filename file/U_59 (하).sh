#!/bin/bash

# 우분투 시스템에 대한 U-59 취약점 진단 스크립트: 숨겨진 파일 및 디렉터리 점검 (상위 10개 결과만 출력)

echo "▶ U-59(하)◀"
echo " 취약 판단 기준 : 불필요하거나 의심스러운 숨겨진 파일 및 디렉터리가 존재하는 경우 취약하다고 판단"

# 탐색할 디렉토리 설정 (기본값은 /)
TARGET_DIR=${1:-/}

# 1. 최근 30일 이내에 수정된 숨겨진 파일 찾기 (상위 10개)
echo "Recently modified hidden files (last 30 days) - Top 10:"
hidden_files_recent=$(find $TARGET_DIR -type f -name ".*" -mtime -30 2>/dev/null | head -n 10)
echo "$hidden_files_recent"
echo ""

# 2. 최근 30일 이내에 수정된 숨겨진 디렉터리 찾기 (상위 10개)
echo "Recently modified hidden directories (last 30 days) - Top 10:"
hidden_dirs_recent=$(find $TARGET_DIR -type d -name ".*" -mtime -30 2>/dev/null | head -n 10)
echo "$hidden_dirs_recent"
echo ""

# 3. 100MB 이상의 숨겨진 파일 찾기 (상위 10개)
echo "Hidden files larger than 100MB - Top 10:"
hidden_files_large=$(find $TARGET_DIR -type f -name ".*" -size +100M 2>/dev/null | head -n 10)
echo "$hidden_files_large"
echo ""

# 숨겨진 파일 및 디렉터리 개수 계산
hidden_files_recent_count=$(echo "$hidden_files_recent" | grep -v '^$' | wc -l)
hidden_dirs_recent_count=$(echo "$hidden_dirs_recent" | grep -v '^$' | wc -l)
hidden_files_large_count=$(echo "$hidden_files_large" | grep -v '^$' | wc -l)

# 결과 판단
if [ $hidden_files_recent_count -gt 0 ] || [ $hidden_dirs_recent_count -gt 0 ] || [ $hidden_files_large_count -gt 0 ]; then
    echo "※ U-59(하) 결과 : 취약(Vulnerable)"
    echo " 불필요하거나 의심스러운 숨겨진 파일 및 디렉터리가 발견되었습니다."
else
    echo "※ U-59(하) 결과 : 양호(Good)"
    echo " 불필요하거나 의심스러운 숨겨진 파일 및 디렉터리가 존재하지 않습니다."
fi

exit 0
