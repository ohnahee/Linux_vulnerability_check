#!/bin/bash

echo "=========================="
echo "U-08 (상)"
echo "점검 사항: /etc/shadow 파일의 소유자 및 권한 점검"
echo "=========================="

# 점검 결과 변수 초기화
result="양호"
reason="/etc/shadow 파일의 소유자가 root이고 권한이 400입니다."

# /etc/shadow 파일 소유자 확인
owner=$(stat -c %U /etc/shadow)

# /etc/shadow 파일 권한 확인
permissions=$(stat -c %a /etc/shadow)

# 소유자 및 권한 진단
if [ "$owner" != "root" ]; then
    result="취약"
    reason="/etc/shadow 파일의 소유자가 root가 아닙니다."
fi

if [ "$permissions" != "400" ]; then
    result="취약"
    reason="/etc/shadow 파일의 권한이 400가 아닙니다."
fi

# 점검 결과 출력
echo "=== 점검 결과: $result ==="
echo "이유: $reason"

if [ "$result" = "취약" ]; then
    echo "상세 정보:"
    if [ "$owner" != "root" ]; then
        echo " /etc/shadow 파일의 소유자가 $owner 입니다."
    fi
    if [ "$permissions" != "400" ]; then
        echo " /etc/shadow 파일의 권한이 $permissions 입니다."
    fi
fi

exit 0
