#!/bin/bash

echo "=========================="
echo "U-10 (상)"
echo "점검 사항: /etc/inetd.conf 또는 /etc/xinetd.conf 파일의 소유자 및 권한 점검"
echo "=========================="

# 점검 대상 파일 목록
files=("/etc/inetd.conf" "/etc/xinetd.conf")

# 결과 초기화
result="양호"
reason="모든 점검 파일의 소유자가 root이고 권한이 600입니다."
files_checked=false

# 파일 점검 함수
check_file() {
    local file=$1
    if [ -e "$file" ]; then
        files_checked=true
        local owner=$(stat -c %U "$file")
        local permissions=$(stat -c %a "$file")

        # 소유자 및 권한 진단
        if [ "$owner" != "root" ]; then
            result="취약"
            reason="$file 파일의 소유자가 root가 아닙니다."
        fi

        if [ "$permissions" -ne "600" ]; then
            result="취약"
            reason="$file 파일의 권한이 600이 아닙니다. (현재 권한: $permissions)"
        fi

        # 파일 상태 출력
        echo "$file 소유자: $owner, 권한: $permissions"
    else
        echo "$file 파일이 존재하지 않습니다."
    fi
}

# 모든 파일 점검
for file in "${files[@]}"; do
    check_file "$file"
done

# 최종 결과 출력
if [ "$files_checked" = false ]; then
    echo "※ 점검 결과: /etc/inetd.conf 또는 /etc/xinetd.conf 파일이 시스템에 존재하지 않습니다."
elif [ "$result" = "취약" ]; then
    echo "※ 결과 : 취약(Vulnerable)"
    echo "$reason"
else
    echo "※ 결과 : 양호(Good)"
    echo "$reason"
fi

exit 0
