#!/bin/bash

echo "▶ U-07(상)◀"
echo "취약 판단 기준 : /etc/passwd 파일의 소유자가 root가 아니거나 파일 권한이 644 이하가 아니면 취약하다고 판단"

# /etc/passwd 파일 소유자 확인
owner=$(stat -c %U /etc/passwd)

# /etc/passwd 파일 권한 확인
permissions=$(stat -c %a /etc/passwd)

# 결과 초기화
vulnerable=false

# 소유자 및 권한 진단
if [ "$owner" != "root" ]; then
    echo "/etc/passwd 파일의 소유자가 root가 아닙니다."
    vulnerable=true
fi

if [ "$permissions" -ne 644 ]; then
    echo "/etc/passwd 파일의 권한이 644 이하가 아닙니다."
    vulnerable=true
fi

# 최종 결과 출력
if [ "$vulnerable" = true ]; then
    echo "※ 결과 : 취약(Vulnerable)"
    if [ "$owner" != "root" ]; then
        echo " /etc/passwd 파일의 소유자가 $owner 입니다."
    fi
    if [ "$permissions" -ne 644 ]; then
        echo " /etc/passwd 파일의 권한이 $permissions 입니다."
    fi
else
    echo "※ 결과 : 양호(Good)"
    echo " /etc/passwd 파일의 소유자가 root이고 권한이 644 이하입니다."
fi

exit 0
