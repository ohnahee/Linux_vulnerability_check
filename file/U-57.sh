#!/bin/bash

echo "=========================="
echo "U-57 (중)"
echo "점검 사항: 홈 디렉터리의 소유자 외 타사용자가 해당 홈 디렉터리를 수정할 수 없도록 제한하는지 점검"
echo "=========================="

# 결과 초기화
result="양호"
reason="모든 사용자 홈 디렉터리의 소유자가 해당 사용자이며, 타 사용자 쓰기 권한이 없습니다."

# 사용자별 홈 디렉터리의 소유자와 권한 점검
awk -F: '{ print $1, $6 }' /etc/passwd | while read user dir; do
    if [ -d "$dir" ]; then
        owner=$(stat -c %U "$dir")
        permissions=$(stat -c %A "$dir")

        echo "사용자: $user, 홈 디렉터리: $dir"
        echo "소유자: $owner, 권한: $permissions"

        # 소유자가 해당 계정인지 확인
        if [ "$owner" != "$user" ]; then
            result="취약"
            reason="$dir 디렉터리의 소유자가 $user가 아닙니다."
            echo "$reason"
        fi

        # 타 사용자의 쓰기 권한이 있는지 확인
        if [ "$(echo $permissions | cut -c9)" != "-" ]; then
            result="취약"
            reason="$dir 디렉터리에 타 사용자의 쓰기 권한이 있습니다."
            echo "$reason"
        fi
        echo ""
    fi
done

# 점검 결과 출력
echo "=== 점검 결과: $result ==="
echo "이유: $reason"

exit 0
