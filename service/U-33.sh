#!/bin/bash

echo "=========================="
echo "U-33 (상)"
echo "점검 사항: BIND 최신 버전 사용 유무 및 주기적 보안 패치 여부 점검"
echo "=========================="

# 점검 결과 변수 초기화
result="양호"
reason="BIND 서비스가 실행 중이며 최신 버전을 사용하고 있습니다."

# BIND 서비스 실행 여부 확인
BIND_PROCESS=$(ps -ef | grep named | grep -v grep)

if [ -z "$BIND_PROCESS" ]; then
    result="취약"
    reason="BIND 서비스가 실행 중이지 않습니다."
else
    echo "BIND 서비스가 실행 중입니다."
    
    # BIND 버전 확인
    BIND_VERSION=$(named -v 2>/dev/null)
    
    if [ -z "$BIND_VERSION" ]; then
        result="취약"
        reason="BIND가 설치되지 않았거나 named 명령어를 찾을 수 없습니다."
    else
        echo "BIND 버전: $BIND_VERSION"
        
        # 최신 버전과 비교 (예: 최신 버전이 9.10.3-P2일 경우)
        LATEST_VERSION="9.10.3-P2"
        
        if [[ "$BIND_VERSION" < "$LATEST_VERSION" ]]; then
            result="취약"
            reason="BIND 버전이 최신 버전보다 낮습니다. ($BIND_VERSION)"
        fi
    fi
fi

# 점검 결과 출력
echo "=== 점검 결과: $result ==="
echo "이유: $reason"
