#!/bin/bash

echo "=========================="
echo "U-27 (상)"
echo "점검 사항: 불필요한 RPC 서비스의 실행 여부 점검"
echo "=========================="

# 점검할 서비스 목록
services=(
  "rpc.cmsd"
  "rpc.ttdbserverd"
  "sadmind"
  "rusersd"
  "walld"
  "sprayd"
  "rstatd"
  "rpc.nisd"
  "rexd"
  "rpc.pcnfsd"
  "rpc.statd"
  "rpc.ypupdated"
  "rpc.rquotad"
  "kcms_server"
  "cachefsd"
)

# 점검 결과 변수 초기화
result="양호"
reason="모든 불필요한 RPC 서비스가 비활성화되어 있습니다."

# /etc/inetd.conf 파일 존재 여부 확인
if [ ! -f /etc/inetd.conf ]; then
  echo "/etc/inetd.conf 파일을 찾을 수 없습니다."
  exit 1
fi

# 불필요한 RPC 서비스 활성화 여부 점검
for service in "${services[@]}"; do
  if grep -q "^$service" /etc/inetd.conf; then
    result="취약"
    reason="$service 서비스가 활성화되어 있습니다."
    break
  fi
done

# 점검 결과 출력
echo "=== 점검 결과: $result ==="
echo "이유: $reason"
