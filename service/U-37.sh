#!/bin/bash

echo "=========================="
echo "U-37 (상)"
echo "점검 사항: 상위 경로로 이동이 가능한지 여부 점검"
echo "=========================="

# 점검 결과 변수 초기화
result="양호"
reason="상위 경로 이동이 제한되어 있습니다."

# Apache 설정 파일 경로
apache_config_files=("/etc/apache2/apache2.conf" "/etc/apache2/conf-available/*.conf" "/etc/apache2/sites-available/*.conf")

# AllowOverride 설정 확인
allow_override_set=false
for config_file in "${apache_config_files[@]}"; do
    if grep -qi "AllowOverride None" $config_file; then
        allow_override_set=true
        break
    fi
done

# 점검 결과 설정
if $allow_override_set; then
    result="취약"
    reason="AllowOverride 지시자가 None으로 설정되어 있습니다."
else
    htaccess_files=$(sudo find /var/www -name .htaccess)
    if [ -z "$htaccess_files" ]; then
        result="취약"
        reason=".htaccess 파일이 존재하지 않습니다."
    fi
fi

# 점검 결과 출력
echo "=== 점검 결과: $result ==="
echo "이유: $reason"
