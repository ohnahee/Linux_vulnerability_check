#!/bin/bash

echo "=========================="
echo "U-36 (상)"
echo "점검 사항: Apache 데몬이 root 권한으로 구동되는지 여부 점검"
echo "=========================="

# 점검 결과 변수 초기화
result="양호"
reason="Apache 데몬이 제한된 권한으로 구동되고 있습니다."

# Apache 데몬이 root 권한으로 구동되는지 확인
if ps -ef | grep -v grep | grep apache2 | grep -q root; then
    result="취약"
    reason="Apache 데몬이 root 권한으로 구동되고 있습니다."
else
    result="양호"
    reason="Apache 데몬이 root 권한으로 구동되지 않고 있습니다."
fi

# Apache 설정 파일에서 User 및 Group 지시자 확인
apache_config_file="/etc/apache2/apache2.conf"
user_setting=$(grep -E "^\s*User" $apache_config_file)
group_setting=$(grep -E "^\s*Group" $apache_config_file)

# User 및 Group 설정 확인
if [[ "$user_setting" == "User www-data" && "$group_setting" == "Group www-data" ]]; then
    reason="$reason 설정 파일에서 User 및 Group이 www-data로 설정되어 있습니다."
else
    result="취약"
    reason="$reason 설정 파일에서 User 및 Group이 www-data로 설정되어 있지 않습니다."
fi

# 점검 결과 출력
echo "=== 점검 결과: $result ==="
echo "이유: $reason"
