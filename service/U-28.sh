#!/bin/bash

echo "=========================="
echo "U-28 (상)"
echo "점검 사항: 안전하지 않은 NIS 서비스의 비활성화, 안전한 NIS+ 서비스의 활성화 여부 점검"
echo "=========================="

# 점검 결과 변수 초기화
result="양호"
reason="NIS 서비스가 비활성화되어 있고 NIS+ 서비스가 활성화되어 있습니다."

# NIS 서비스 상태 확인
nis_services=("ypserv" "ypbind" "ypxfrd")
for service in "${nis_services[@]}"; do
  if ps -ef | egrep -q "[${service:0:1}]${service:1}"; then
    result="취약"
    reason="$service 서비스가 활성화되어 있습니다."
    break
  fi
done

# NIS+ 서비스 상태 확인 (NIS 서비스가 비활성화된 경우에만 점검)
if [ "$result" == "양호" ]; then
  if ! ps -ef | egrep -q "[r]pc.nisd"; then
    result="취약"
    reason="NIS+ 서비스가 비활성화되어 있습니다."
  fi
fi

# 점검 결과 출력
echo "=== 점검 결과: $result ==="
echo "이유: $reason"
