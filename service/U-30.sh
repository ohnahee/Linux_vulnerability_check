#!/bin/bash

echo "=========================="
echo "U-30 (상)"
echo "점검 사항: 취약한 버전의 Sendmail 서비스 이용 여부 점검"
echo "=========================="

# 점검 결과 변수 초기화
result="양호"
reason="Sendmail 서비스가 최신 버전을 사용하고 있습니다."

# 최신 버전 변수 설정
latest_version="8.15.2"

# Sendmail 버전 확인
current_version=$(sendmail -d0.1 -bv root 2>/dev/null | grep -oP 'Version \K[0-9\.]+')

if [[ -z "$current_version" ]]; then
  result="취약"
  reason="Sendmail 서비스가 설치되어 있지 않거나 동작하지 않고 있습니다."
elif [[ "$(printf '%s\n' "$current_version" "$latest_version" | sort -V | head -n1)" != "$latest_version" ]]; then
  result="취약"
  reason="Sendmail 서비스가 최신 버전이 아닙니다. (현재 버전: $current_version)"
fi

# 점검 결과 출력
echo "=== 점검 결과: $result ==="
echo "이유: $reason"
