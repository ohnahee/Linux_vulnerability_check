#!/bin/bash

echo "▶ U-04(상)◀"
echo "취약 판단 기준 : 쉐도우 패스워드 정책이 적용되지 않은 경우 취약하다고 판단"

# /etc/passwd 파일에서 패스워드 필드를 확인
vulnerable=false

while IFS=: read -r username password rest; do
    # 패스워드 필드가 비어 있지 않으면서 암호화되지 않은 경우 취약
    if [[ -n "$password" && "$password" != "x" && "$password" != "*" && "$password" != "!" ]]; then
        echo "※ 사용자 $username: 패스워드가 암호화되지 않았습니다."
        vulnerable=true
    fi
done < /etc/passwd

if [ "$vulnerable" = true ]; then
    echo "※ 결과 : 취약(Vulnerable)"
    echo " 일부 사용자 계정의 패스워드가 암호화되지 않았습니다."
    echo " 쉐도우 패스워드 정책을 적용하려면 'sudo pwconv' 명령을 실행하십시오."
else
    echo "※ 결과 : 양호(Good)"
    echo " 모든 사용자 계정의 패스워드가 암호화되어 있습니다."
fi

exit 0
