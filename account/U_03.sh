#!/bin/bash

echo "▶ U-03(상)◀"
echo "취약 판단 기준 : 계정 잠금 임계값이 설정되어 있지 않거나, 10회 이하의 값으로 설정되지 않은 경우 취약하다고 판단"

# 점검 기준 설정
DENY=5
UNLOCK_TIME=900

# 설정 파일 경로
FAILLOCK_FILE="/etc/security/faillock.conf"

# 설정 파일이 존재하는지 확인
if [ ! -f "$FAILLOCK_FILE" ]; then
    echo "※ U-03(상) 결과 : 취약(Vulnerable)"
    echo " 설정 파일($FAILLOCK_FILE)이 존재하지 않습니다."
    exit 1
fi

# faillock.conf 파일에서 설정 확인
faillock_deny=$(grep -E "^deny\s*=\s*$DENY" "$FAILLOCK_FILE")
faillock_unlock_time=$(grep -E "^unlock_time\s*=\s*$UNLOCK_TIME" "$FAILLOCK_FILE")

if [ -z "$faillock_deny" ] || [ -z "$faillock_unlock_time" ]; then
    echo "※ U-03(상) 결과 : 취약(Vulnerable)"
    echo " $FAILLOCK_FILE 파일에서 설정이 누락되었거나 올바르지 않습니다."
    exit 1
fi

echo "※ U-03(상) 결과 : 양호(Good)"
echo " 계정 잠금 정책 설정이 올바르게 구성되어 있습니다."

exit 0
