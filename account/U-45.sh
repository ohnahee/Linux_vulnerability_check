#!/bin/bash

echo "=========================="
echo "U-06 (상)"
echo "점검 사항 : su 명령어 사용을 허용하는 사용자를 지정한 그룹 설정 여부 점검"
echo "=========================="

# /etc/pam.d/su 파일 점검
check_pam_su() {
    echo "PAM 설정에서 pam_wheel.so 설정 확인"
    pam_wheel_check=$(grep pam_wheel.so /etc/pam.d/su)
    if [ -n "$pam_wheel_check" ]; then
        echo "양호: PAM 설정에서 pam_wheel.so 설정이 존재합니다:"
        echo "$pam_wheel_check"
    else
        echo "취약: PAM 설정에서 pam_wheel.so 설정이 존재하지 않습니다. 모든 사용자가 su 명령어를 사용할 수 있습니다."
    fi
}

# 그룹 점검 함수
check_group() {
    group_name=$1
    echo "$group_name 그룹 확인"
    group_check=$(getent group $group_name)
    if [ -n "$group_check" ]; then
        echo "양호: $group_name 그룹이 존재하며, 다음 사용자가 속해 있습니다:"
        echo "$group_check"
    else
        echo "취약: $group_name 그룹이 존재하지 않거나 비어 있습니다."
    fi
}

# 점검 실행
check_pam_su
check_group "wheel"
check_group "sudo"
