#!/bin/bash

#!/bin/bash

echo "▶ U-01(상)◀"
echo " 취약 판단 기준 : 시스템 정책에 root 계정의 원격 터미널 접속 차단 설정이 적용되어 있는 경우 양호하다고 판단"

# /etc/ssh/sshd_config 파일에서 PermitRootLogin 설정 확인
permit_root_login=$(grep -E '^PermitRootLogin' /etc/ssh/sshd_config | awk '{print $2}')

# PermitRootLogin 설정 값을 확인하고, root 계정의 원격 접속 차단 여부 판단
if [[ "$permit_root_login" == "no" ]]; then
    echo "※ U-01(상) 결과 : 양호(Good)"
    echo " 시스템 정책에 root 계정의 원격 터미널 접속 차단 설정이 적용되어 있습니다."
else
    echo "※ U-01(상) 결과 : 취약(Vulnerable)"
    echo " 시스템 정책에 root 계정의 원격 터미널 접속 차단 설정이 적용되어 있지 않습니다. 현재 설정: $permit_root_login"
fi

echo ""
echo "▶ Telnet 사용 여부 점검◀"
echo " 취약 판단 기준 : 시스템에서 Telnet을 사용하는 경우 취약하다고 판단"

# Telnet 클라이언트와 서버 설치 여부 확인
telnet_client_installed=$(dpkg -l | grep -w 'telnet' | wc -l)
telnet_server_installed=$(dpkg -l | grep -w 'telnetd' | wc -l)

# Telnet 서비스 실행 여부 확인
telnet_service_running=$(systemctl is-active inetd)

if [[ "$telnet_client_installed" -gt 0 || "$telnet_server_installed" -gt 0 || "$telnet_service_running" == "active" ]]; then
    echo "※ Telnet 결과 : 취약(Vulnerable)"
    if [[ "$telnet_client_installed" -gt 0 ]]; then
        echo " Telnet 클라이언트가 설치되어 있습니다."
    fi
    if [[ "$telnet_server_installed" -gt 0 ]]; then
        echo " Telnet 서버가 설치되어 있습니다."
    fi
    if [[ "$telnet_service_running" == "active" ]]; then
        echo " Telnet 서비스가 실행 중입니다."
    fi
else
    echo "※ Telnet 결과 : 양호(Good)"
    echo " 시스템에서 Telnet을 사용하지 않습니다."
fi

exit 0
