#!/bin/bash

echo "=========================="
echo "U-52 (중)"
echo "점검 사항 : /etc/passwd 파일 내 UID가 동일한 사용자 계정 존재 여부 점검"
echo "=========================="

# 동일한 UID를 가진 사용자 계정을 확인
duplicate_uids=$(awk -F: '{print $3 " : " $1}' /etc/passwd | sort | uniq -d -f 1)

if [ -z "$duplicate_uids" ]; then
    echo "양호: /etc/passwd 파일 내 동일한 UID를 가진 사용자 계정이 없습니다."
else
    echo "취약: /etc/passwd 파일 내 동일한 UID를 가진 사용자 계정이 존재합니다:"
    echo "$duplicate_uids"
    echo
    echo "동일한 UID를 가진 계정이 있는 경우, 보안 취약점이 될 수 있습니다. 적절히 조치하십시오."
    echo "조치 방법:"
    echo "1. UID가 중복된 계정을 확인합니다."
    echo "2. 중복된 UID 중 하나를 새로운 UID로 변경합니다."
    echo "   예: sudo usermod -u NEW_UID username"
    echo "3. UID가 변경된 사용자가 소유한 파일과 디렉토리의 소유자를 새로운 UID로 변경합니다."
    echo "   예: sudo find / -user OLD_UID -exec chown -h NEW_UID {} \\;"
    echo "4. 동일한 과정을 중복된 다른 계정에도 적용합니다."
fi

