#!/bin/bash

echo "=========================="
echo "U-01 (상)"
echo "점검 사항 : Root 계정의 원격 터미널 접속 차단 설정을 점검" 
echo "참고 : 이전 버전에서는 telnet도 사용하였지만 보안상 telnet을 사용하는 경우 취약하다고 진단"
echo "=========================="

# SSH 설정 파일 경로
SSH_CONFIG="/etc/ssh/sshd_config"

# 점검 결과 변수 초기화
result="양호"
reason="Root 계정의 원격 접속이 적절하게 차단되어 있습니다."

# SSH를 통한 root 계정 원격 접속 설정 확인
if grep -q "^PermitRootLogin" $SSH_CONFIG; then
  PermitRootLogin=$(grep "^PermitRootLogin" $SSH_CONFIG)
  if [[ "$PermitRootLogin" != "PermitRootLogin no" ]]; then
    result="취약"
    reason="PermitRootLogin 설정이 'no'로 되어 있지 않습니다."
  fi
else
  result="취약"
  reason="PermitRootLogin 설정이 sshd_config 파일에 없습니다."
fi

# telnet 서비스 확인
if systemctl is-active --quiet telnet.socket; then
  result="취약"
  reason="Telnet 서비스가 활성화되어 있습니다."
fi

# 점검 결과 출력
echo "=== 점검 결과: $result ==="
echo "이유: $reason"
