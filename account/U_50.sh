#!/bin/bash

echo "▶ U-50(하)◀"
echo " 취약 판단 기준 : 관리자 그룹에 불필요한 계정이 등록되어 있는 경우"

# 불필요한 계정 목록
UNNECESSARY_ACCOUNTS="daemon|bin|sys|adm|listen|nobody|nobody4|noaccess|diag|operator|gopher|games|ftp|apache|httpd|www-data|mysql|mariadb|postgres|mail|postfix|news|lp|uucp|nuucp"

# 관리자 그룹 (sudo 또는 admin)에 속한 사용자 확인
ADMIN_GROUPS="sudo|admin"

# 관리자 그룹에 속한 사용자 목록 추출
admin_users=$(getent group $ADMIN_GROUPS | awk -F: '{print $4}' | tr ',' '\n' | sort -u)

# 불필요한 계정이 관리자 그룹에 있는지 검사
if [ -n "$admin_users" ]; then
    if echo "$admin_users" | grep -wE "$UNNECESSARY_ACCOUNTS" > /dev/null; then
        echo "※ U-50(하) 결과 : 취약(Vulnerable)"
        echo " 관리자 그룹에 불필요한 계정이 등록되어 있습니다:"
        echo "$admin_users" | grep -wE "$UNNECESSARY_ACCOUNTS"
        exit 0
    else
        echo "※ U-50(하) 결과 : 양호(Good)"
        echo " 관리자 그룹에 불필요한 계정이 없습니다."
        exit 0
    fi
else
    echo "※ U-50(하) 결과 : 양호(Good)"
    echo " 관리자 그룹에 등록된 사용자가 없습니다."
    exit 0
fi
