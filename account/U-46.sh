#!/bin/bash

echo "=========================="
echo "U-46 (중)"
echo "점검 사항 : 패스워드 최소 길이 설정 (8자 이상) 적용 여부 점검"
echo "=========================="

# /etc/login.defs 파일 점검
check_login_defs() {
    echo "/etc/login.defs 파일 점검"
    minlen_login_defs=$(grep "^PASS_MIN_LEN" /etc/login.defs | awk '{print $2}')
    if [ -z "$minlen_login_defs" ]; then
        echo "취약: /etc/login.defs 파일에 PASS_MIN_LEN 설정이 없습니다."
    elif [ "$minlen_login_defs" -lt 8 ]; then
        echo "취약: /etc/login.defs 파일에 설정된 PASS_MIN_LEN 값이 8자 미만입니다: $minlen_login_defs"
    else
        echo "양호: /etc/login.defs 파일에 PASS_MIN_LEN 설정이 8자 이상으로 되어 있습니다: $minlen_login_defs"
    fi
}

# /etc/pam.d/common-password 파일 점검
check_common_password() {
    echo "/etc/pam.d/common-password 파일 점검"
    minlen_common_password=$(grep -E "pam_pwquality.so|pam_cracklib.so" /etc/pam.d/common-password | grep -oP "minlen=\K\d+" | sort -nr | head -n 1)
    if [ -z "$minlen_common_password" ]; then
        echo "취약: /etc/pam.d/common-password 파일에 minlen 설정이 없습니다."
    elif [ "$minlen_common_password" -lt 8 ]; then
        echo "취약: /etc/pam.d/common-password 파일에 설정된 minlen 값이 8자 미만입니다: $minlen_common_password"
    else
        echo "양호: /etc/pam.d/common-password 파일에 minlen 설정이 8자 이상으로 되어 있습니다: $minlen_common_password"
    fi
}

# 점검 실행
check_login_defs
check_common_password
